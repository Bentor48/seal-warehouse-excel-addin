<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∏—Å–∫ –∫–æ–ª—å—Ü–∞</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .threeColumns {
            display: flex;
            justify-content: space-between;
            flex-direction: row;
            align-items: center;
            gap: 10px; 
        }

        .textFor {
            width: 25%;
            text-align: center;
        }

        .rightInputTwo {
            width: 62.5%;
        }
        .topTextForm {
            margin-bottom: 10px;
        }

        .button {
            margin-bottom: 10px;
        }
    </style>
</head>
<body class="forForm">
    <form id="ringFormSearch">
        <div class="container head">
            <h1>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∫–æ–ª—å—Ü–∞</h1>
        </div>

        <div class="container mtlp startSearch">
            <h2>–ü–æ–∏—Å–∫ –ø–æ:</h2>
            <select id="searchBy" class="selectType forH2Select">
                <option value="parameters">–ü–∞—Ä–∞–º–µ—Ç—Ä–∞–º</option>
                <option value="rnNumber">–ü–æ –Ω–æ–º–µ—Ä—É –†–ù</option>
            </select>
        </div>

        <div id="parameters">

            <div class="container mtlp">
                <label for="typeSearch" class="topText">–¢–∏–ø –∫–æ–ª—å—Ü–∞</label>
                <input type="text" id="typeSearch" class="normalInput" list="typeListSearch" placeholder="–í—ã–±–µ—Ä–∏ –∏–ª–∏ –≤–≤–µ–¥–∏ —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç">
                <datalist id="typeListSearch">
                    <option value="–ü—Ä–æ–∫–ª–∞–¥–∫–∞">
                    <option value="O-ring">
                    <option value="X-ring">
                    <option value="D-ring">
                    <option value="U-ring">
                    <option value="V-ring">
                </datalist>
            </div>

            <div class="container mtlp">
                <label for="materialSearch" class="topText">–ú–∞—Ç–µ—Ä–∏–∞–ª</label>
                <input type="text" id="materialSearch" class="normalInput" list="materialListSearch" placeholder="–í—ã–±–µ—Ä–∏ –∏–ª–∏ –≤–≤–µ–¥–∏ —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç">
                <datalist id="materialListSearch">
                    <option value="NBR">
                    <option value="FPM">
                    <option value="PTFE">
                </datalist>
            </div>

            <div class="container">
                    <div class ="threeColumns">
                    <label for="shdSearch">–¢–≤—ë—Ä–¥–æ—Å—Ç—å (–ø–æ –®–æ—Ä—É):</label>

                <input type="number" id="shdSearch1" min="0" class="rightInput" list="typeOfHardness">
                    <datalist id="typeOfHardness">
                        <option value="70">
                        <option value="75">
                        <option value="80">
                        <option value="90">
                    </datalist>
                    </div>
            </div>

            <div class="container">
                <div class="topTextForm">–¢–∏–ø–æ–≤–æ–π —Ä–∞–∑–º–µ—Ä:</div>

                    <div class="threeColumns">
                        <div class="textFor">
                            <label for="inDiameterForm" class="leftText">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä:</label>
                        </div>
                        <input type="number" id="inDiameterForm" placeholder="–û—Ç"  min="0" class="rightInput">
                        <input type="number" id="inDiameterTo" placeholder="–î–æ"  min="0" class="rightInput">
                    </div>

                    <div class="threeColumns">
                        <div class="textFor">
                            <label for="outDiameterForm" class="leftText">–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä:</label>
                        </div>
                        <input type="number" id="outDiameterForm" placeholder="–û—Ç" min="0" class="rightInput">
                        <input type="number" id="outDiameterTo" placeholder="–î–æ" min="0" class="rightInput">
                    </div>

                    <div class="threeColumns">
                        <div class="textFor">
                            <label for="sectionSearchForm" class="leftText">–°–µ—á–µ–Ω–∏–µ:</label>
                        </div>
                        <input type="number" id="sectionSearchForm" placeholder="–û—Ç" min="0" class="rightInput">
                        <input type="number" id="sectionSearchTo" placeholder="–î–æ" min="0" class="rightInput">
                    </div>
            </div>

            <div class="container">
                <div class="threeColumns">
                    <label for="inStockSearch">–¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏</label>
                    <input type="checkbox" id="inStockSearch" class="rightInput">
                </div>
            </div>

        </div>

        <div id="numberNR" style="display: none">

            <div class="container mtlp">
                <label for="numberRNSearch" class="topText">–ü–æ –Ω–æ–º–µ—Ä—É –†–ù</label>
                <input  type="text" class="normalInput" id="numberRNSearch" placeholder="002284" autocomplete="off">
            </div>

        </div>

        <button type="submit" class="button search" >–ü–æ–∏—Å–∫</button>
    </form>
        <button type="button" class="button submit" id="resetBtn">–°–±—Ä–æ—Å</button>
        <button class="button back" id="backButton" onclick="back()">–ù–∞–∑–∞–¥</button>
</body>
<footer>
  <p class="footer">
    ¬© 2026 –ú–∏—Ö–∞–∏–ª –ü–æ–ª—Ç–∞–≤—Å–∫–∏–π
    <span class="dot">¬∑</span>
    –ú–æ–π GitHub ‚Äî
    <a href="https://github.com/Bentor48"
       target="_blank"
       rel="noopener noreferrer"
       class="github-link"
       aria-label="–ú–æ–π GitHub">

      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"
           xmlns="http://www.w3.org/2000/svg">
        <path d="M12 .5C5.73.5.5 5.74.5 12.02c0 5.11 3.29 9.45 7.86 10.98.58.11.79-.25.79-.56
        0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54
        -.53-1.36-1.3-1.72-1.3-1.72
        -1.06-.73.08-.72.08-.72
        1.17.08 1.79 1.2 1.79 1.2
        1.04 1.78 2.73 1.27 3.4.97
        .11-.75.41-1.27.74-1.56
        -2.56-.29-5.26-1.28-5.26-5.69
        0-1.26.45-2.29 1.19-3.1
        -.12-.29-.52-1.46.11-3.05
        0 0 .97-.31 3.18 1.18
        .92-.26 1.9-.39 2.88-.39
        .98 0 1.96.13 2.88.39
        2.2-1.49 3.18-1.18 3.18-1.18
        .63 1.59.23 2.76.11 3.05
        .74.81 1.19 1.84 1.19 3.1
        0 4.42-2.7 5.39-5.27 5.67
        .42.36.8 1.08.8 2.18
        0 1.57-.01 2.84-.01 3.23
        0 .31.21.68.8.56
        4.57-1.53 7.85-5.87 7.85-10.98
        C23.5 5.74 18.27.5 12 .5z"/>
      </svg>
    </a>
  </p>
</footer>
<script>
// –í—ã–±–æ—Ä –º–µ–∂–¥—É –ø–æ–∏—Å–∫–æ–º –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏ –ø–æ –Ω–æ–º–µ—Ä—É –†–ù
const searchSelect = document.getElementById('searchBy');
const parametersForSearch = document.getElementById('parameters');
const numberNRSearch = document.getElementById('numberNR');

function setDisabled(container, disabled) {
    const inputs = container.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        input.disabled = disabled;
    });
}

function clearInputs(container) {
    container.querySelectorAll('input').forEach(input => {
        if (input.type === 'checkbox') {
            input.checked = false;
        } else {
            input.value = '';
        }
    });
}



function updateSearchMode() {
    parametersForSearch.style.display = 'none';
    numberNRSearch.style.display = 'none';

    setDisabled(parametersForSearch, true);
    setDisabled(numberNRSearch, true);

    if (searchSelect.value === "parameters") {
        parametersForSearch.style.display = 'block';
        setDisabled(parametersForSearch, false);
    } else if (searchSelect.value === "rnNumber") {
        numberNRSearch.style.display = 'block';
        setDisabled(numberNRSearch, false);
    }
}

searchSelect.addEventListener('change', () => {
    clearInputs(parametersForSearch);
    clearInputs(numberNRSearch);
    updateSearchMode();
});

updateSearchMode();

const form = document.getElementById("ringFormSearch");

form.addEventListener("submit", async (event) => {
    event.preventDefault();
    await search();
});



// –ü–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –í–ù–ï –≤—Å—è–∫–∏—Ö –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π, –ø—Ä—è–º–æ –≤ –∫–æ—Ä–Ω–µ <script>
window.hideExcelRow = async function(rowNumber) {
    console.log("–ü–æ–ø—ã—Ç–∫–∞ —Å–∫—Ä—ã—Ç—å —Å—Ç—Ä–æ–∫—É:", rowNumber);
    try {
        await Excel.run(async (context) => {
            const sheet = context.workbook.worksheets.getActiveWorksheet();
            const range = sheet.getRange(`${rowNumber}:${rowNumber}`);
            range.rowHidden = true;
            await context.sync();
            console.log(`‚úÖ –°—Ç—Ä–æ–∫–∞ ${rowNumber} —Å–∫—Ä—ã—Ç–∞ –≤ Excel`);
        });
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ Excel. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 'rings'):", err);
    }
};

window.showAll = async function() {
    try {
        await Excel.run(async (context) => {
            context.workbook.worksheets.getActiveWorksheet().getUsedRange().rowHidden = false;
            await context.sync();
            console.log("‚úÖ –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –æ—Ç–∫—Ä—ã—Ç—ã");
        });
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å—Ç—Ä–æ–∫:", err);
    }
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Office (–ø—É—Å—Ç–∞—è, –ø—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã –∞–¥–¥–æ–Ω –Ω–µ –ø–∞–¥–∞–ª)
Office.onReady((info) => {
    if (info.host === Office.HostType.Excel) {
        console.log("Office –≥–æ—Ç–æ–≤, —Ö–æ—Å—Ç: Excel");
        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Ä–µ–∞–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–µ –Ω–∏–∂–µ
        getAllRows();
}

});

let ringsDatabase = [];



async function getAllRows() {
    try {
        await Excel.run(async (context) => {

            const sheet = context.workbook.worksheets.getActiveWorksheet();
            const usedRange = sheet.getUsedRange();

            usedRange.load("values");
            await context.sync();

            const values = usedRange.values;

            if (!values || values.length < 2) {
                console.warn("–¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö");
                ringsDatabase = null;
                return;
            }

            // –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É (—Å–ª—É–∂–µ–±–Ω—É—é, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å)
            // –û—Å—Ç–∞–≤–ª—è–µ–º: [–∑–∞–≥–æ–ª–æ–≤–∫–∏ + –¥–∞–Ω–Ω—ã–µ]
            ringsDatabase = values.slice(2);

            console.log("ringsDatabase:", ringsDatabase);
        });
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ Excel:", error.debugInfo || error);
    }
}



async function search() {

    await window.showAll();

    if (searchSelect.value === "rnNumber") {

    const rn = String(document.getElementById("numberRNSearch").value).trim();

        if (!rn) {
            console.warn("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –†–ù –¥–ª—è –ø–æ–∏—Å–∫–∞.");
            return;
        }

    console.log("–ù–∞—á–∏–Ω–∞—é –ø–æ–∏—Å–∫ –†–ù:", rn);

    let count = 3;

        for (let char of ringsDatabase) {
            if (String(char[4] || "").trim() !== rn) {
                await window.hideExcelRow(count);
            }
            count++;
        }

    } else if (searchSelect.value === "parameters") {

    // ===== –ü–û–ò–°–ö –ü–û –ü–ê–†–ê–ú–ï–¢–†–ê–ú =====

    const type = String(document.getElementById("typeSearch").value).trim();
    const material = String(document.getElementById("materialSearch").value).trim();
    const shd = Number(document.getElementById("shdSearch1").value) || null;

    // --- –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä ---
    function getNumberOrNaN(id) {
        const v = document.getElementById(id).value.trim();
        return v === "" ? NaN : Number(v);
    }

    const inVals1 = getNumberOrNaN("inDiameterForm");
    const inVals2 = getNumberOrNaN("inDiameterTo");


    // --- –≤–Ω–µ—à–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä ---
    const outVals1 = getNumberOrNaN("outDiameterForm");
    const outVals2 = getNumberOrNaN("outDiameterTo");

    // --- —Å–µ—á–µ–Ω–∏–µ ---
    const sectionSearch1 = getNumberOrNaN("sectionSearchForm");
    const sectionSearch2 = getNumberOrNaN("sectionSearchTo");

    const inStock = document.getElementById("inStockSearch").checked;

    let count = 3;

        for (const char of ringsDatabase) {

            if (inStock) {
                const qty = Number(char[3]) || 0;
                if (qty <= 0) {
                    await window.hideExcelRow(count);
                    count++;
                    continue;
                }
            }

            if (type) {
                if (String(char[6] || "").trim() !== type) {
                    await window.hideExcelRow(count);
                    count++;
                    continue;
                }
            }

            if (material) {
                if (String(char[7] || "").trim() !== material) {
                    await window.hideExcelRow(count);
                    count++;
                    continue;
                }
            }

            if (shd) {
                if (shd !== Number(char[8])) {
                    await window.hideExcelRow(count);
                    count++;
                    continue;
                }
            }

            // --- –≤–Ω–µ—à–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä ---
            const hasInFilter1 = !isNaN(outVals1) || !isNaN(outVals2);

            if (hasInFilter1) {

                const val = Number(char[10]);

                // –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –≤–∫–ª—é—á—ë–Ω, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ Excel –Ω–µ —á–∏—Å–ª–æ
                if (isNaN(val)) {
                    await window.hideExcelRow(count);
                    count++;
                    continue;
                }

                // üîπ –≤–≤–µ–¥–µ–Ω—ã –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è
                if (!isNaN(outVals1) && !isNaN(outVals2)) {

                    const min = Math.min(outVals1, outVals2);
                    const max = Math.max(outVals1, outVals2);

                    if (val < min || val > max) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }

                // üîπ –≤–≤–µ–¥–µ–Ω–æ –¢–û–õ–¨–ö–û "–û—Ç"
                } else if (!isNaN(outVals1)) {

                    if (val < outVals1) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }

                // üîπ –≤–≤–µ–¥–µ–Ω–æ –¢–û–õ–¨–ö–û "–î–æ"
                } else if (!isNaN(outVals2)) {

                    if (val > outVals2) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }
                }
            }


            // --- –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä ---
            const hasInFilter2 = !isNaN(inVals1) || !isNaN(inVals2);

            if (hasInFilter2) {

                const val = Number(char[9]);

                // –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –≤–∫–ª—é—á—ë–Ω, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ Excel –Ω–µ —á–∏—Å–ª–æ
                if (isNaN(val)) {
                    await window.hideExcelRow(count);
                    count++;
                    continue;
                }

                // üîπ –≤–≤–µ–¥–µ–Ω—ã –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è
                if (!isNaN(inVals1) && !isNaN(inVals2)) {

                    const min = Math.min(inVals1, inVals2);
                    const max = Math.max(inVals1, inVals2);

                    if (val < min || val > max) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }

                // üîπ –≤–≤–µ–¥–µ–Ω–æ –¢–û–õ–¨–ö–û "–û—Ç"
                } else if (!isNaN(inVals1)) {

                    if (val < inVals1) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }

                // üîπ –≤–≤–µ–¥–µ–Ω–æ –¢–û–õ–¨–ö–û "–î–æ"
                } else if (!isNaN(inVals2)) {

                    if (val > inVals2) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }
                }
            }

            // --- —Å–µ—á–µ–Ω–∏–µ ---
            const hasInFilter3 = !isNaN(sectionSearch1) || !isNaN(sectionSearch2);

            if (hasInFilter3) {

                const val = Number(char[11]);

                // –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –≤–∫–ª—é—á—ë–Ω, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ Excel –Ω–µ —á–∏—Å–ª–æ
                if (isNaN(val)) {
                    await window.hideExcelRow(count);
                    count++;
                    continue;
                }

                // üîπ –≤–≤–µ–¥–µ–Ω—ã –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è
                if (!isNaN(sectionSearch1) && !isNaN(sectionSearch2)) {

                    const min = Math.min(sectionSearch1, sectionSearch2);
                    const max = Math.max(sectionSearch1, sectionSearch2);

                    if (val < min || val > max) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }

                // üîπ –≤–≤–µ–¥–µ–Ω–æ –¢–û–õ–¨–ö–û "–û—Ç"
                } else if (!isNaN(sectionSearch1)) {

                    if (val < sectionSearch1) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }

                // üîπ –≤–≤–µ–¥–µ–Ω–æ –¢–û–õ–¨–ö–û "–î–æ"
                } else if (!isNaN(sectionSearch2)) {

                    if (val > sectionSearch2) {
                        await window.hideExcelRow(count);
                        count++;
                        continue;
                    }
                }
            }

            count++;
        }
    }
}


const reset = document.getElementById("resetBtn");

reset.addEventListener("click", async (event) => {
    event.preventDefault();

    form.reset();              // –æ—á–∏—â–∞–µ—Ç –í–°–Æ —Ñ–æ—Ä–º—É
    updateSearchMode();        // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
    await window.showAll();    // –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ Excel
});

function back() {
    window.location.href = "taskpane.html";
}
</script>
</html>